{% extends "base.html" %}
{% block content %}
{% if download %}
  <iframe src="{{ download }}" style="display:none" aria-hidden="true"></iframe>
{% endif %}

<div class="card">
  <div class="card-header" style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: var(--space-4); border-left: 4px solid var(--teal-500);">
    <div>
      <h1 class="card-title" style="color: var(--teal-800); display: flex; align-items: center; gap: var(--space-3);">
        <svg style="width: 28px; height: 28px; color: var(--teal-600);" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
        Danh s√°ch ph·ª• l·ª•c
      </h1>
      <p style="font-size: var(--text-sm); color: var(--text-secondary); margin-top: var(--space-2);">
        üìé Qu·∫£n l√Ω v√† theo d√µi t·∫•t c·∫£ ph·ª• l·ª•c theo nƒÉm
      </p>
    </div>
    <form style="display: flex; gap: var(--space-2); align-items: center;" method="get" action="/annexes">
      <div class="form-group" style="margin: 0;">
        <input
          name="year"
          value="{{ year }}"
          class="form-input"
          placeholder="NƒÉm"
          style="width: 120px; border: 2px solid var(--teal-300);"
        />
      </div>
      <button class="btn btn-info" type="submit">
        <svg style="width: 16px; height: 16px;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
        </svg>
        L·ªçc
      </button>
    </form>
  </div>

  <div class="card-body">
    <div style="margin-bottom: var(--space-4); position: relative;">
      <svg style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); width: 20px; height: 20px; color: var(--teal-500); pointer-events: none;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg>
      <input
        type="text"
        placeholder="üîç T√¨m ki·∫øm theo s·ªë Hƒê, s·ªë PL..."
        class="form-input"
        data-table-search="annexes-table"
        style="max-width: 500px; padding-left: var(--space-10); border: 2px solid var(--teal-200); background: linear-gradient(135deg, white 0%, var(--teal-50) 100%);"
      />
    </div>

    <div class="table-wrapper" data-enhanced-table="annexes-table">
      <table class="table">
        <thead>
          <tr>
            <th data-sort="text">
              <div style="display: flex; align-items: center; gap: var(--space-2);">
                <svg style="width: 16px; height: 16px; color: var(--primary-600);" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14" />
                </svg>
                S·ªë h·ª£p ƒë·ªìng
              </div>
            </th>
            <th data-sort="text">
              <div style="display: flex; align-items: center; gap: var(--space-2);">
                <svg style="width: 16px; height: 16px; color: var(--teal-600);" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                S·ªë ph·ª• l·ª•c
              </div>
            </th>
            <th data-sort="date">
              <div style="display: flex; align-items: center; gap: var(--space-2);">
                <svg style="width: 16px; height: 16px; color: var(--info-600);" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                Ng√†y t·∫°o
              </div>
            </th>
            <th>Thao t√°c</th>
          </tr>
        </thead>
        <tbody>
          {% for r in rows %}
            <tr>
              <td><strong style="color: var(--primary-700);">{{ r.contract_no }}</strong></td>
              <td>
                {% if r.annex_no %}
                  <span class="badge badge-teal">PL {{ r.annex_no }}</span>
                {% else %}
                  <span style="color: var(--text-tertiary);">-</span>
                {% endif %}
              </td>
              <td><span style="color: var(--text-secondary); font-size: var(--text-sm);">{{ r.created_at }}</span></td>
              <td>
                {% if r.download_url %}
                  <a href="{{ r.download_url }}" class="btn btn-sm btn-success" title="T·∫£i xu·ªëng">
                    <svg class="icon" style="width: 14px; height: 14px;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    T·∫£i xu·ªëng
                  </a>
                {% else %}
                  <span style="color: var(--text-tertiary);">-</span>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>

      {% if rows|length == 0 %}
        <div class="empty-state">
          <svg class="empty-state-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          <div class="empty-state-title">Ch∆∞a c√≥ ph·ª• l·ª•c</div>
          <div class="empty-state-description">Ch∆∞a c√≥ d·ªØ li·ªáu cho nƒÉm {{ year }}</div>
        </div>
      {% endif %}

      <div class="table-pagination" data-pagination-for="annexes-table"></div>
    </div>
  </div>

  <div class="card-footer" style="background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--teal-50) 100%);">
    <a href="/annexes/new" class="btn btn-primary">
      <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
      </svg>
      T·∫°o ph·ª• l·ª•c m·ªõi
    </a>
  </div>
</div>
{% endblock %}

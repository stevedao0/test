{% extends "base.html" %}
{% block content %}
<div class="card">
  <div class="card-header">
    <h1 class="card-title">Chỉnh sửa hợp đồng</h1>
    <p style="font-size: var(--text-sm); color: var(--text-secondary); margin-top: var(--space-2);">
      Số hợp đồng: <strong>{{ contract.contract_no }}</strong>
    </p>
  </div>

  {% if error %}
    <div class="card-body">
      <div class="alert alert-error">
        <svg class="alert-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
        <div class="alert-content">
          <div class="alert-message">{{ error }}</div>
        </div>
      </div>
    </div>
  {% endif %}

  <form method="post" action="/contracts/{{ year }}/{{ contract.contract_no }}/update">
    <div class="card-body">
      <div class="form-section">
        <h2 class="form-section-title">Thông tin hợp đồng</h2>

        <div class="form-group">
          <label class="form-label">Ngày lập hợp đồng <span class="required-indicator">*</span></label>
          <input
            type="date"
            name="ngay_lap_hop_dong"
            value="{{ contract.ngay_lap_hop_dong }}"
            class="form-input"
            required
          />
        </div>
      </div>

      <div class="form-section">
        <h2 class="form-section-title">Thông tin đơn vị</h2>

        <div class="form-group">
          <label class="form-label">Tên đơn vị</label>
          <input
            type="text"
            name="don_vi_ten"
            value="{{ contract.don_vi_ten or '' }}"
            class="form-input"
            placeholder="Ví dụ: Công ty TNHH ABC"
          />
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Địa chỉ</label>
            <input
              type="text"
              name="don_vi_dia_chi"
              value="{{ contract.don_vi_dia_chi or '' }}"
              class="form-input"
              placeholder="Địa chỉ đơn vị"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Điện thoại</label>
            <input
              type="text"
              name="don_vi_dien_thoai"
              value="{{ contract.don_vi_dien_thoai or '' }}"
              class="form-input"
              placeholder="Số điện thoại"
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Người đại diện</label>
            <input
              type="text"
              name="don_vi_nguoi_dai_dien"
              value="{{ contract.don_vi_nguoi_dai_dien or '' }}"
              class="form-input"
              placeholder="Họ và tên"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Chức vụ</label>
            <input
              type="text"
              name="don_vi_chuc_vu"
              value="{{ contract.don_vi_chuc_vu or 'Giám đốc' }}"
              class="form-input"
              placeholder="Giám đốc"
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Mã số thuế</label>
            <input
              type="text"
              name="don_vi_mst"
              value="{{ contract.don_vi_mst or '' }}"
              class="form-input"
              placeholder="MST"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Email</label>
            <input
              type="email"
              name="don_vi_email"
              value="{{ contract.don_vi_email or '' }}"
              class="form-input"
              placeholder="email@example.com"
            />
          </div>
        </div>
      </div>

      <div class="form-section">
        <h2 class="form-section-title">Thông tin kênh YouTube</h2>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Tên kênh</label>
            <input
              type="text"
              name="kenh_ten"
              value="{{ contract.kenh_ten or '' }}"
              class="form-input"
              placeholder="Tên kênh YouTube"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Kênh ID hoặc URL</label>
            <input
              type="text"
              name="kenh_id"
              value="{{ contract.kenh_id or '' }}"
              class="form-input"
              placeholder="UC... hoặc https://youtube.com/channel/..."
            />
          </div>
        </div>
      </div>

      <div class="form-section">
        <h2 class="form-section-title">Thông tin tài chính</h2>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Số tiền chưa VAT</label>
            <input
              type="text"
              name="so_tien_chua_GTGT"
              value="{{ contract.so_tien_chua_GTGT_text or '' }}"
              class="form-input"
              placeholder="15600000 hoặc 15,600,000"
              data-money-input
            />
            <small class="form-hint">Nhập số tiền không bao gồm VAT</small>
          </div>

          <div class="form-group">
            <label class="form-label">Thuế VAT (%)</label>
            <input
              type="text"
              name="thue_percent"
              value="{{ contract.thue_percent or '10' }}"
              class="form-input"
              placeholder="10"
            />
          </div>
        </div>

        <div class="money-calculator-preview" id="money-preview" style="display: none;">
          <div class="preview-row">
            <span>Số tiền chưa VAT:</span>
            <strong id="preview-pre-vat">0 VNĐ</strong>
          </div>
          <div class="preview-row">
            <span>Thuế VAT:</span>
            <strong id="preview-vat">0 VNĐ</strong>
          </div>
          <div class="preview-row preview-total">
            <span>Tổng cộng:</span>
            <strong id="preview-total">0 VNĐ</strong>
          </div>
          <div class="preview-row">
            <span style="font-size: var(--text-sm);">Bằng chữ:</span>
            <em id="preview-words" style="color: var(--text-tertiary);">Không đồng</em>
          </div>
        </div>
      </div>
    </div>

    <div class="card-footer" style="display: flex; gap: var(--space-3); justify-content: flex-end;">
      <a href="/contracts?year={{ year }}" class="btn btn-secondary">Hủy</a>
      <button type="submit" class="btn btn-primary">
        <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
        </svg>
        Cập nhật hợp đồng
      </button>
    </div>
  </form>
</div>

<script src="/static/js/money-calculator.js"></script>
{% endblock %}

{% extends "base.html" %}
{% block content %}
<div class="card" style="margin-bottom: var(--space-8);">
  <div class="card-header">
    <h1 class="card-title">Tạo hợp đồng</h1>
    <p style="font-size: var(--text-sm); color: var(--text-secondary); margin: var(--space-2) 0 0 0;">
      Nhập thông tin để xuất Word + lưu Excel theo năm.
    </p>
  </div>

  <div class="card-body">
    {% if error %}
      <div class="alert alert-error">
        <svg class="alert-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
        <div class="alert-content">
          <div class="alert-message">{{ error }}</div>
        </div>
      </div>
    {% endif %}

    <form method="post" action="/contracts" data-validate-form data-loading>
      <div style="display: grid; gap: var(--space-6); grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));">
        <div class="form-group">
          <label class="form-label" for="ngay_lap_hop_dong">
            Ngày lập hợp đồng <span class="required-indicator">*</span>
          </label>
          <input
            id="ngay_lap_hop_dong"
            name="ngay_lap_hop_dong"
            type="date"
            class="form-input"
            required
            data-validate
          />
          <div class="input-error-text"></div>
        </div>

        <div class="form-group">
          <label class="form-label" for="so_hop_dong_4">
            Số hợp đồng (4 số) <span class="required-indicator">*</span>
          </label>
          <input
            id="so_hop_dong_4"
            name="so_hop_dong_4"
            placeholder="0001"
            class="form-input"
            maxlength="4"
            required
            data-validate
          />
          <div class="input-help-text">Nhập 4 chữ số, ví dụ: 0001</div>
          <div class="input-error-text"></div>
        </div>

        <div class="form-group">
          <label class="form-label" for="linh_vuc">Lĩnh vực</label>
          <input
            id="linh_vuc"
            name="linh_vuc"
            value="Sao chép trực tuyến"
            class="form-input"
          />
        </div>
      </div>

      <div class="card" style="margin-top: var(--space-6);">
        <div class="card-header">
          <h3 style="font-size: var(--text-lg); margin: 0;">Thông tin đơn vị (Bên B)</h3>
        </div>
        <div class="card-body">
          <div style="display: grid; gap: var(--space-6); grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));">
            <div class="form-group">
              <label class="form-label" for="don_vi_ten">Tên đơn vị</label>
              <input
                id="don_vi_ten"
                name="don_vi_ten"
                class="form-input"
              />
            </div>

            <div class="form-group">
              <label class="form-label" for="don_vi_mst">Mã số thuế</label>
              <input
                id="don_vi_mst"
                name="don_vi_mst"
                class="form-input"
                placeholder="0123456789"
                data-validate
              />
              <div class="input-help-text">10-14 chữ số</div>
              <div class="input-error-text"></div>
            </div>

            <div class="form-group" style="grid-column: 1 / -1;">
              <label class="form-label" for="don_vi_dia_chi">Địa chỉ</label>
              <input
                id="don_vi_dia_chi"
                name="don_vi_dia_chi"
                class="form-input"
              />
            </div>

            <div class="form-group">
              <label class="form-label" for="don_vi_dien_thoai">Điện thoại</label>
              <input
                id="don_vi_dien_thoai"
                name="don_vi_dien_thoai"
                class="form-input"
                placeholder="0901234567"
                data-validate
              />
              <div class="input-help-text">Bắt đầu bằng 0, có 10-11 số</div>
              <div class="input-error-text"></div>
            </div>

            <div class="form-group">
              <label class="form-label" for="don_vi_email">Email</label>
              <input
                id="don_vi_email"
                name="don_vi_email"
                type="email"
                class="form-input"
                placeholder="example@company.com"
                data-validate
              />
              <div class="input-error-text"></div>
            </div>

            <div class="form-group">
              <label class="form-label" for="nguoi_thuc_hien_email">Email người thực hiện</label>
              <input
                id="nguoi_thuc_hien_email"
                name="nguoi_thuc_hien_email"
                type="email"
                class="form-input"
                placeholder="executor@company.com"
              />
              <div class="input-help-text">Email người thực hiện trong hợp đồng (không bắt buộc)</div>
              <div class="input-error-text"></div>
            </div>

            <div class="form-group">
              <label class="form-label" for="don_vi_nguoi_dai_dien">Người đại diện</label>
              <input
                id="don_vi_nguoi_dai_dien"
                name="don_vi_nguoi_dai_dien"
                class="form-input"
              />
            </div>

            <div class="form-group">
              <label class="form-label" for="don_vi_chuc_vu">Chức vụ</label>
              <input
                id="don_vi_chuc_vu"
                name="don_vi_chuc_vu"
                value="Giám đốc"
                class="form-input"
              />
            </div>

            <div class="form-group">
              <label class="form-label" for="so_CCCD">Số CCCD/CMND</label>
              <input
                id="so_CCCD"
                name="so_CCCD"
                class="form-input"
                placeholder="001234567890"
              />
              <div class="input-help-text">Số Căn cước công dân hoặc Chứng minh nhân dân</div>
              <div class="input-error-text"></div>
            </div>

            <div class="form-group">
              <label class="form-label" for="ngay_cap_CCCD">Ngày cấp CCCD</label>
              <input
                id="ngay_cap_CCCD"
                name="ngay_cap_CCCD"
                class="form-input"
                placeholder="01/01/2020"
              />
              <div class="input-help-text">Ngày cấp căn cước (không bắt buộc)</div>
              <div class="input-error-text"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="card" style="margin-top: var(--space-6);">
        <div class="card-header">
          <h3 style="font-size: var(--text-lg); margin: 0;">Thông tin kênh</h3>
        </div>
        <div class="card-body">
          <div style="display: grid; gap: var(--space-6); grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));">
            <div class="form-group">
              <label class="form-label" for="kenh_ten">Tên kênh</label>
              <input
                id="kenh_ten"
                name="kenh_ten"
                class="form-input"
              />
            </div>

            <div class="form-group">
              <label class="form-label" for="kenh_id">ID/Link kênh</label>
              <input
                id="kenh_id"
                name="kenh_id"
                placeholder="UCxxxx hoặc https://youtube.com/channel/UCxxxx"
                class="form-input"
                data-validate
              />
              <div class="input-help-text">ID bắt đầu bằng UC hoặc URL YouTube</div>
              <div class="input-error-text"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="card" style="margin-top: var(--space-6);" data-money-calculator>
        <div class="card-header">
          <h3 style="font-size: var(--text-lg); margin: 0;">Thông tin tài chính</h3>
        </div>
        <div class="card-body">
          <div style="display: grid; gap: var(--space-6); grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));">
            <div class="form-group">
              <label class="form-label" for="so_tien_chua_GTGT">Số tiền chưa VAT (VNĐ)</label>
              <div class="money-input-wrapper">
                <input
                  id="so_tien_chua_GTGT"
                  name="so_tien_chua_GTGT"
                  placeholder="15,600,000"
                  class="form-input money-input"
                  data-money-input
                />
                <span class="money-currency">VNĐ</span>
              </div>
              <div class="input-help-text">Nhập số tiền, ví dụ: 15600000</div>
            </div>

            <div class="form-group">
              <label class="form-label" for="thue_percent">Thuế GTGT (%)</label>
              <input
                id="thue_percent"
                name="thue_percent"
                type="number"
                value="10"
                min="0"
                max="100"
                class="form-input"
                data-vat-input
              />
              <div class="input-help-text">Mặc định 10%</div>
            </div>
          </div>

          <div class="money-calculator-preview">
            <div class="preview-row">
              <span>Số tiền chưa VAT:</span>
              <strong data-preview-pre-vat>0 VNĐ</strong>
            </div>
            <div class="preview-row">
              <span>Thuế GTGT:</span>
              <strong data-preview-vat>0 VNĐ</strong>
            </div>
            <div class="preview-row preview-total">
              <span>Tổng cộng:</span>
              <strong data-preview-total>0 VNĐ</strong>
            </div>
            <div class="preview-row">
              <span style="font-size: var(--text-sm);">Bằng chữ:</span>
              <em data-preview-words style="color: var(--text-tertiary);">Không đồng</em>
            </div>
          </div>
        </div>
      </div>

      <div style="margin-top: var(--space-8); display: flex; align-items: center; gap: var(--space-4);">
        <button type="submit" class="btn btn-primary btn-lg" data-submit-btn>
          <span class="btn-spinner">
            <svg class="icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" stroke-opacity="0.25"/>
              <path fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"/>
            </svg>
          </span>
          <span class="btn-text">Xuất Word + Lưu Excel</span>
        </button>
        <a href="/contracts" class="btn btn-secondary">Xem danh sách</a>
      </div>
    </form>
  </div>
</div>

<div class="card">
  <div class="card-header">
    <h3 class="card-title" style="font-size: var(--text-lg);">Ghi chú</h3>
  </div>
  <div class="card-body">
    <ul style="list-style: disc; padding-left: var(--space-6); font-size: var(--text-sm); color: var(--text-secondary); line-height: var(--leading-relaxed);">
      <li>Số hợp đồng đầy đủ sẽ là: <code>0001/YYYY/HĐQTGAN-PN/MR</code></li>
      <li>Năm lấy theo ngày lập hợp đồng</li>
      <li>File Word xuất ra sẽ lưu vào thư mục <code>storage/docx</code></li>
      <li>Excel sẽ lưu theo năm vào <code>storage/excel</code></li>
      <li>Tất cả thông tin sẽ được validate trước khi gửi</li>
      <li>Số tiền sẽ tự động được format và chuyển thành chữ tiếng Việt</li>
    </ul>
  </div>
</div>
{% endblock %}
